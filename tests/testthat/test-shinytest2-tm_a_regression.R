testthat::test_that("e2e - tm_a_regerssion: ", {
  skip_if_too_deep(5)

  # needed untill this is merged https://github.com/insightsengineering/teal/pull/1198
  require(shinytest2)

  data <- within(teal.data::teal_data(), {
    require(nestcolor)
    CO2 <- CO2 # nolint: object_name.
  })
  datanames(data) <- c("CO2")

  app <- TealAppDriver$new(
    data = data,
    modules = tm_a_regression(
      label = "Regression",
      response = teal.transform::data_extract_spec(
        dataname = "CO2",
        select = teal.transform::select_spec(
          label = "Select variable:",
          choices = "uptake",
          selected = "uptake",
          multiple = FALSE,
          fixed = TRUE
        )
      ),
      regressor = teal.transform::data_extract_spec(
        dataname = "CO2",
        select = teal.transform::select_spec(
          label = "Select variables:",
          choices = teal.transform::variable_choices(data[["CO2"]], c("conc", "Treatment")),
          selected = "conc",
          multiple = TRUE,
          fixed = FALSE
        )
      ),
      ggplot2_args = teal.widgets::ggplot2_args(
        labs = list(subtitle = "Plot generated by Regression Module")
      )
    )
  )

  app$expect_no_shiny_error()
  #app$open_url()

  app$stop()

})
